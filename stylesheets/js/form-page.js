function sendForm(){if("FormData"in window){var e=document.querySelector(".form-content__form");e.addEventListener("submit",function(t){t.preventDefault();var a=new FormData(e);requestAjax(a,function(e){console.log(e)})})}}function requestAjax(e,t){var a=new XMLHttpRequest,n=(new Date).getTime();a.open("post","http://simonenko.su/academy/echo?"+n,!0),a.addEventListener("readystatechange",function(){var e=document.querySelector(".popup-overlay"),n=document.querySelector(".request-popup"),r=document.querySelector(".failure-popup");if(4==a.readyState)if(200==a.status){t(a.responseText),localStorage.clear(),console.log(e);var o=n.querySelector(".request-popup__button");e.classList.add("popup-overlay--show"),n.classList.add("request-popup--hidden"),o.addEventListener("click",function(t){t.preventDefault(),n.classList.remove("request-popup--hidden"),e.classList.remove("popup-overlay--show")})}else{var i=r.querySelector(".failure-popup__button");e.classList.add("popup-overlay--show"),r.classList.add("failure-popup--hidden"),i.addEventListener("click",function(t){t.preventDefault(),r.classList.remove("failure-popup--hidden"),e.classList.remove("popup-overlay--show")})}}),a.send(e)}function addLocalStorage(){if(window.localStorage)for(var e=document.querySelector(".form-content__form"),t=e.querySelectorAll("[name]"),a=0;a<t.length;a++)getState(t[a]),setState(t[a])}function getState(e){var t=e.getAttribute("name");e.value=localStorage.getItem(t)||""}function setState(e){var t=e.getAttribute("name"),a=function(){console.info("Форма обнаружена ===!");var e=this.value;e||(e=""),localStorage.setItem(t,e)};e.addEventListener("keyup",a)}function preview(e){if(e.type.match(/image.*/)){var t=new FileReader;t.addEventListener("load",function(t){var a=document.createElement("figure"),n=document.createElement("img"),r=document.createElement("a"),o=document.createElement("figcaption");n.src=t.target.result,n.alt=e.name,r.classList.add("travel-photo__btn-cancel"),r.innerHTML="&times;",r.href="#",o.innerHTML=e.name.toUpperCase(),adder.appendChild(a),a.appendChild(n),a.appendChild(r),a.appendChild(o),r.addEventListener("click",function(e){e.preventDefault(),this.parentNode.remove()})}),t.readAsDataURL(e)}}function travelersBox(e){var t=0,a=document.querySelector(e.wrap);this.init=function(e){t=+e,a.innerHTML="";for(var n=1;t>=n;n++){var r=o(n);a.innerHTML+=r}i()},this.change=function(e){var e=+e;return e!=t?e>t?n(e):r(e):!1};var n=function(e){if(t=+e,a.children.length<t){var n=o(t);a.innerHTML+=n,i()}},r=function(e){t=+e,a.lastChild.remove()},o=function(e){var e=+e,t='<div class="travelers__row">                            <div class="travelers__names">                                <header>                                    <span>№</span>                                    <label for="traveler-name">Имя:                                        <sup>*</sup>                                    </label>                                </header>                                <span class="travelers__form-number">'+e+'</span>                                <input type="text" name="traveler-name['+e+']" tabindex="13" value="" placeholder="Введите ваше имя" required>                                <button class="travelers__name--delete">Удалить</button>                            </div>                            <div class="travelers__nick">                                <label for="traveler-nick">Прозвище:</label>                                <input type="text" name="traveler-nick['+e+']" tabindex="13" value="" placeholder="Ну как же без этого!" required>                            </div>                        </div>';return t},i=function(){for(var n=a.querySelectorAll("button.travelers__name--delete"),r=n.length-1;r>=0;r--)n[r].addEventListener("click",function(n){n.preventDefault(),this.parentNode.parentNode.remove(),t=+a.children.length,e.counter.value=t,t>0&&l(t)})},l=function(e){for(var t=a.children,n=0,r=1;n<=t.length-1,e>=r;n++,r++)t[n].querySelector(".travelers__form-number").innerText=r,t[n].querySelector(".travelers__names input[type=text]").name="traveler-name["+r+"]",t[n].querySelector(".travelers__nick input[type=text]").name="traveler-nick["+r+"]"}}function Counter(e){function t(){0!=r.value&&(r.value=+r.value-1)}function a(){r.value!=o&&(r.value=+r.value+1)}var n=document.querySelector(e.wrap),r=document.querySelector(e.box),o=+e.max>0?+e.max:30,i=e.travelersBox?new travelersBox({wrap:e.travelersBox,counter:r}):!1,l=this;n.addEventListener("click",function(n){n.preventDefault(),n.target.className==e.minus?t():n.target.className==e.plus&&a(),i instanceof travelersBox&&i.change(r.value)}),r.oninput=function(e){var t=/^[^A-Za-zА-Яа-я/]+$/g;return this.value.match(t)?void l.setCount(+this.value):void(this.value=this.value.replace(/[A-Za-zА-Яа-я]+/,""))},this.setCount=function(e){r.value=0>+e?0:o>=+e?+e:o,i instanceof travelersBox&&i.init(r.value)}}function diffDate(){var e=(new Date(checkout.value).getTime(),new Date(departure.value).getTime()),t=Math.floor((e-dateCheckout)/1e3/60/60/24);tripDuration.value=0>t?0:t}function plusDate(e){if(!checkout.value){date=new Date;var t=(date.getMonth()+1).toString(),t=t[1]?t:"0"+t[0],a=date.getDate().toString(),a=a[1]?a:"0"+a[0];checkout.value=date.getFullYear()+"-"+t+"-"+a,checkout.addEventListener("change",function(){plusDate(tripLasting.value),departure.addEventListener("change",function(){diffDate()})})}var n=new Date(checkout.value).getTime(),r=Math.floor(1e3*e*60*60*24+n),o=new Date(r),t=(o.getMonth()+1).toString(),t=t[1]?t:"0"+t[0],a=o.getDate().toString(),a=a[1]?a:"0"+a[0];departure.value=o.getFullYear()+"-"+t+"-"+a}function changeNumbers(e,t){parseInt(t.value)+e<1?t.value=1:parseInt(t.value)+e>=1&&parseInt(t.value)+e<=30?(t.value||(t.value=1),t.value=parseInt(t.value)+e):t.value=1}if(document.querySelector(".form-content__form")&&(addLocalStorage(),sendForm()),"FileReader"in window){var area=document.querySelector(".travel-photo"),adder=document.querySelector(".travel-photo__images");area.querySelector("#upload__photo").addEventListener("change",function(){for(var e=this.files,t=0;t<e.length;t++)preview(e[t])})}var calc=new Counter({wrap:".trip-date-wrapper",box:".travel-duration__trip-date"});calc.setCount(0);var calcTravalers=new Counter({wrap:".travelers__count",box:".travelers__trip-count",minus:"travelers__btn-minus",plus:"travelers__btn-plus",max:9,travelersBox:".travelers__info-form"});if(calcTravalers.setCount(2),document.querySelector(".form-content__form")){var tripLasting=document.getElementById("trip-lasting"),btnMinus=document.querySelector(".travel-duration__btn-minus"),btnPlus=document.querySelector(".travel-duration__btn-plus");btnMinus.addEventListener("click",function(e){e.preventDefault(),changeNumbers(-1,tripLasting),plusDate(tripLasting.value)}),btnPlus.addEventListener("click",function(e){e.preventDefault(),changeNumbers(1,tripLasting),plusDate(tripLasting.value)}),tripLasting.addEventListener("change",function(){tripLasting.value&&plusDate(tripLasting.value)}),checkout.addEventListener("change",function(){checkout.value&&plusDate(tripLasting.value)})}window.isMobile=function(){var e=!1;return function(t,a){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e},$(function(){isMobile()||$("input[type=date]").datepicker({dateFormat:"yy-mm-dd",minDate:"-90",onSelect:function(){checkout.value&&plusDate(tripLasting.value)}})});